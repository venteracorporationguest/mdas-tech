- name: run the playbook tasks on the localhost
  hosts: local
  connection: local

  tasks:

  - name: Cleanup
    file:
      path: '{{ item }}'
      state: absent
    with_items:
      - ../keys

  - name: Create Directory for SSH Keys
    file:
      path: ../keys
      state: directory

  - name: Generate SSH Keypair
    command: ssh-keygen -f ../keys/mdas -t rsa -b 2048 -m pem -N ''

  - name: Run Terraform - This will take some time (5 - 15 mins)
    terraform:
      project_path: '../terraform'
      state: present
      force_init: yes
